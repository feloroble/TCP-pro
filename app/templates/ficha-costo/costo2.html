{% extends 'base.html' %}

 {% block content %}
<section id="features" class="ud-features">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="alert alert-dismissible fade show" role="alert">
      {% for category, message in messages %}
         <div class="alert alert-{{ category }} mb-3">{{ message }}</div>
      {% endfor %}
   </div>
   {% endif %}
 {% endwith %}
 <div class="container mt-4">
    <h1>Ficha de Costo para {{ product.name }}</h1>

  <!-- Opciones Generales -->
  <form method="POST">
      <input type="hidden" name="form_type" value="general_options">
      <h2>Opciones Generales</h2>
      <label for="production_level">Nivel de Producción:</label>
      <input type="number" name="production_level" value="{{ cost_sheet.production_level }}">
      
      <label for="utilization_percentage">Porcentaje de Utilización:</label>
      <input type="number" step="0.01" name="utilization_percentage" value="{{ cost_sheet.utilization_percentage }}">
      
      <button type="submit" class="btn btn-success mb-3 fixed-width-btn">Guardar Opciones Generales</button>
  </form>

  <!-- Gastos Directos -->
  <form method="POST">
      <input type="hidden" name="form_type" value="direct_costs">
      <h2>Gastos Directos</h2>
      <table class="table table-striped table-bordered">
          <thead>
              <tr>
                  <th>Concepto</th>
                  <th>Fila</th>
                  <th>Costo Base</th>
                  <th>Costo Nuevo</th>
                  <th>Acciones</th>
              </tr>
          </thead>
          <tbody>
              {% for concept in direct_concepts %}
              <tr>
                  <td><input type="text" name="concept[]" value="{{ concept.concept }}"></td>
                  <td><input type="number" name="row[]" value="{{ concept.row }}"></td>
                  <td><input type="number" step="0.01" name="base_cost[]" value="{{ concept.base_cost }}"></td>
                  <td><input type="number" step="0.01" name="new_cost[]" value="{{ concept.new_cost }}"></td>
                  <td>
                      <form action="{{ url_for('ficha-costo.delete_concept', concept_id=concept.id) }}" method="POST" style="display:inline;">
                          <button type="submit" class="btn btn-danger btn-sm" >Eliminar</button>
                      </form>
                  </td>
              </tr>
              {% endfor %}
              <tr>
                  <td><input type="text" name="concept[]"></td>
                  <td><input type="number" name="row[]"></td>
                  <td><input type="number" step="0.01" name="base_cost[]"></td>
                  <td><input type="number" step="0.01" name="new_cost[]"></td>
              </tr>
          </tbody>
      </table>
      <button type="submit">Guardar Gastos Directos</button>
  </form>

  <!-- Gastos Indirectos -->
  <form method="POST">
      <input type="hidden" name="form_type" value="indirect_costs">
      <h2>Gastos Indirectos</h2>
      <table class="table table-striped table-bordered" >
          <thead>
              <tr>
                  <th>Concepto</th>
                  <th>Fila</th>
                  <th>Costo Base</th>
                  <th>Costo Nuevo</th>
                  <th>Acciones</th>
              </tr>
          </thead>
          <tbody>
              {% for concept in indirect_concepts %}
              <tr>
                  <td><input type="text" name="concept[]" value="{{ concept.concept }}"></td>
                  <td><input type="number" name="row[]" value="{{ concept.row }}"></td>
                  <td><input type="number" step="0.01" name="base_cost[]" value="{{ concept.base_cost }}"></td>
                  <td><input type="number" step="0.01" name="new_cost[]" value="{{ concept.new_cost }}"></td>
                  <td>
                      <form action="{{ url_for('ficha-costo.delete_concept', concept_id=concept.id) }}" method="POST" style="display:inline;">
                          <button type="submit" class="btn btn-danger btn-sm" >Eliminar</button>
                      </form>
                  </td>
              </tr>
              {% endfor %}
              <tr>
                  <td><input type="text" name="concept[]"></td>
                  <td><input type="number" name="row[]"></td>
                  <td><input type="number" step="0.01" name="base_cost[]"></td>
                  <td><input type="number" step="0.01" name="new_cost[]"></td>
              </tr>
          </tbody>
      </table>
      <button type="submit">Guardar Gastos Indirectos</button>
  </form>
</div>
</section>
{% endblock %}

